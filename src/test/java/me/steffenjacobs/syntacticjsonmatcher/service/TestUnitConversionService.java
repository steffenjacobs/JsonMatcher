package me.steffenjacobs.syntacticjsonmatcher.service;

import javax.xml.bind.JAXBException;

import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;

/** @author Steffen Jacobs */
public class TestUnitConversionService {

	private static UnitConversionService unitConversionService;

	@BeforeClass
	public static void init() {
		unitConversionService = new UnitConversionService();
	}

	@Test
	public void testExtractResult() throws JAXBException {
		final String input = "<?xml version='1.0' encoding='UTF-8'?>\r\n<queryresult success='true'\r\n    error='false'\r\n    numpods='8'\r\n    datatypes='Country,GasMark,Quantity'\r\n    timedout=''\r\n    timedoutpods=''\r\n    timing='2.539'\r\n    parsetiming='0.858'\r\n    parsetimedout='false'\r\n    recalculate=''\r\n    id='MSPa57831bfbh83a57be21cd00004ab88077edg99161'\r\n    host='http://www4f.wolframalpha.com'\r\n    server='28'\r\n    related='http://www4f.wolframalpha.com/api/v2/relatedQueries.jsp?id=MSPa57841bfbh83a57be21cd00003dga357e9i2hi0a87931354083698071672'\r\n    version='2.6'>\r\n    <pod title='Input interpretation'\r\n     scanner='Identity'\r\n     id='Input'\r\n     position='100'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57851bfbh83a57be21cd00004bhe5h16ddh2cf62?MSPStoreType=image/gif&amp;s=28'\r\n       alt='convert 23. \u00B0C (degrees Celsius) to degrees Fahrenheit'\r\n       title='convert 23. \u00B0C (degrees Celsius) to degrees Fahrenheit'\r\n       width='350'\r\n       height='18' />\r\n            <plaintext>convert 23. \u00B0C (degrees Celsius) to degrees Fahrenheit</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Result'\r\n     scanner='Identity'\r\n     id='Result'\r\n     position='200'\r\n     error='false'\r\n     numsubpods='1'\r\n     primary='true'>\r\n        <subpod title=''\r\n      primary='true'>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57861bfbh83a57be21cd0000315009ddaifa7721?MSPStoreType=image/gif&amp;s=28'\r\n       alt='73.4 \u00B0F (degrees Fahrenheit)'\r\n       title='73.4 \u00B0F (degrees Fahrenheit)'\r\n       width='181'\r\n       height='18' />\r\n            <plaintext>73.4 \u00B0F (degrees Fahrenheit)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Additional conversions'\r\n     scanner='Unit'\r\n     id='AdditionalConversion'\r\n     position='300'\r\n     error='false'\r\n     numsubpods='4'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57871bfbh83a57be21cd000056844e937gb251a2?MSPStoreType=image/gif&amp;s=28'\r\n       alt='296.1 K (kelvins)'\r\n       title='296.1 K (kelvins)'\r\n       width='104'\r\n       height='18' />\r\n            <plaintext>296.1 K (kelvins)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57881bfbh83a57be21cd0000346h55e1ad33ad5a?MSPStoreType=image/gif&amp;s=28'\r\n       alt='533.1 \u00B0R (degrees Rankine)'\r\n       title='533.1 \u00B0R (degrees Rankine)'\r\n       width='172'\r\n       height='18' />\r\n            <plaintext>533.1 \u00B0R (degrees Rankine)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57891bfbh83a57be21cd00004b6g4f02i70c4e99?MSPStoreType=image/gif&amp;s=28'\r\n       alt='18.4 \u00B0R\u00E9 (degrees R\u00E9aumur)'\r\n       title='18.4 \u00B0R\u00E9 (degrees R\u00E9aumur)'\r\n       width='180'\r\n       height='18' />\r\n            <plaintext>18.4 \u00B0R\u00E9 (degrees R\u00E9aumur)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57901bfbh83a57be21cd0000602e43625171f616?MSPStoreType=image/gif&amp;s=28'\r\n       alt='19.6 \u00B0R\u00F8 (degrees R\u00F8mer)'\r\n       title='19.6 \u00B0R\u00F8 (degrees R\u00F8mer)'\r\n       width='164'\r\n       height='18' />\r\n            <plaintext>19.6 \u00B0R\u00F8 (degrees R\u00F8mer)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Comparisons as temperature'\r\n     scanner='Unit'\r\n     id='ComparisonAsTemperature'\r\n     position='400'\r\n     error='false'\r\n     numsubpods='3'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57911bfbh83a57be21cd00003dhc2ce1f5177ca3?MSPStoreType=image/gif&amp;s=28'\r\n       alt='7.2 \u00B0F below optimum temperature for eating halavah (100 \u00B0S)'\r\n       title='7.2 \u00B0F below optimum temperature for eating halavah (100 \u00B0S)'\r\n       width='391'\r\n       height='18' />\r\n            <plaintext>7.2 \u00B0F below optimum temperature for eating halavah (100 \u00B0S)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57921bfbh83a57be21cd00003d10i71c3hf52b5h?MSPStoreType=image/gif&amp;s=28'\r\n       alt='5.4 \u00B0F above temperature at STP (standard temperature and pressure), using the National Institute of Standards and Technology convention (20 \u00B0C)'\r\n       title='5.4 \u00B0F above temperature at STP (standard temperature and pressure), using the National Institute of Standards and Technology convention (20 \u00B0C)'\r\n       width='510'\r\n       height='66' />\r\n            <plaintext>5.4 \u00B0F above temperature at STP (standard temperature and pressure), using the National Institute of Standards and Technology convention (20 \u00B0C)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57931bfbh83a57be21cd0000306h6gh7b2945878?MSPStoreType=image/gif&amp;s=28'\r\n       alt='5 \u00B0F above conventional US room temperature (68 \u00B0F)'\r\n       title='5 \u00B0F above conventional US room temperature (68 \u00B0F)'\r\n       width='334'\r\n       height='18' />\r\n            <plaintext>5 \u00B0F above conventional US room temperature (68 \u00B0F)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Interpretation'\r\n     scanner='Unit'\r\n     id='Interpretation'\r\n     position='500'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57941bfbh83a57be21cd000018gh3a13155309be?MSPStoreType=image/gif&amp;s=28'\r\n       alt='temperature'\r\n       title='temperature'\r\n       width='81'\r\n       height='18' />\r\n            <plaintext>temperature</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Basic unit dimensions'\r\n     scanner='Unit'\r\n     id='BasicUnitDimensions'\r\n     position='600'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57951bfbh83a57be21cd000034c5299f659de7i3?MSPStoreType=image/gif&amp;s=28'\r\n       alt='[temperature]'\r\n       title='[temperature]'\r\n       width='89'\r\n       height='18' />\r\n            <plaintext>[temperature]</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Corresponding quantities'\r\n     scanner='Unit'\r\n     id='CorrespondingQuantity'\r\n     position='700'\r\n     error='false'\r\n     numsubpods='3'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57961bfbh83a57be21cd00004gdb4ga0ahd5a1ee?MSPStoreType=image/gif&amp;s=28'\r\n       alt='Thermodynamic energy E from E = kT:\r\n | 26 meV (millielectronvolts)'\r\n       title='Thermodynamic energy E from E = kT:\r\n | 26 meV (millielectronvolts)'\r\n       width='259'\r\n       height='41' />\r\n            <plaintext>Thermodynamic energy E from E = kT:\r\n | 26 meV (millielectronvolts)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57971bfbh83a57be21cd00004abda637e2619211?MSPStoreType=image/gif&amp;s=28'\r\n       alt='Blackbody energy flux \u03A6 from \u03A6 = \u03C3T^4:\r\n | 436 W/m^2 (watts per square meter)'\r\n       title='Blackbody energy flux \u03A6 from \u03A6 = \u03C3T^4:\r\n | 436 W/m^2 (watts per square meter)'\r\n       width='257'\r\n       height='43' />\r\n            <plaintext>Blackbody energy flux \u03A6 from \u03A6 = \u03C3T^4:\r\n | 436 W/m^2 (watts per square meter)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57981bfbh83a57be21cd000036i7d96gg6ddi492?MSPStoreType=image/gif&amp;s=28'\r\n       alt='Approximate luminous exitance from a planar blackbody radiator perpendicular to its surface:\r\n | 8\u00D710^-22 lx (lux)'\r\n       title='Approximate luminous exitance from a planar blackbody radiator perpendicular to its surface:\r\n | 8\u00D710^-22 lx (lux)'\r\n       width='528'\r\n       height='62' />\r\n            <plaintext>Approximate luminous exitance from a planar blackbody radiator perpendicular to its surface:\r\n | 8\u00D710^-22 lx (lux)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Nearest corresponding gas marks'\r\n     scanner='UnitInformation'\r\n     id='GasMark:QuantityData'\r\n     position='800'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4f.wolframalpha.com/Calculate/MSP/MSP57991bfbh83a57be21cd000066fe0i8e4de9651b?MSPStoreType=image/gif&amp;s=28'\r\n       alt=' | temperature | usage\r\nthermostat 1 | 30 \u00B0C | France\r\n(actual measurements may vary)'\r\n       title=' | temperature | usage\r\nthermostat 1 | 30 \u00B0C | France\r\n(actual measurements may vary)'\r\n       width='278'\r\n       height='85' />\r\n            <plaintext> | temperature | usage\r\nthermostat 1 | 30 \u00B0C | France\r\n(actual measurements may vary)</plaintext>\r\n        </subpod>\r\n        <states count='1'>\r\n            <state name='Show non\u2010metric'\r\n       input='GasMark:QuantityData__Show non\u2010metric' />\r\n        </states>\r\n    </pod>\r\n    <sources count='1'>\r\n        <source url='http://www.wolframalpha.com/sources/GasMarkSourceInformationNotes.html'\r\n      text='Gas mark' />\r\n    </sources>\r\n</queryresult>";
		Assert.assertEquals("73.4 °F (degrees Fahrenheit)", unitConversionService.extractResult(input, "23.3°C", "°F"));
	}

	@Test
	public void testExtractResult2() throws JAXBException {
		final String input = "<?xml version='1.0' encoding='UTF-8'?>\r\n<queryresult success='true'\r\n    error='false'\r\n    numpods='7'\r\n    datatypes=''\r\n    timedout=''\r\n    timedoutpods=''\r\n    timing='1.7830000000000001'\r\n    parsetiming='0.47900000000000004'\r\n    parsetimedout='false'\r\n    recalculate=''\r\n    id='MSPa1821616i6e1h5f9860h8e00003ibe5hee940g1c5h'\r\n    host='http://www4b.wolframalpha.com'\r\n    server='41'\r\n    related='http://www4b.wolframalpha.com/api/v2/relatedQueries.jsp?id=MSPa1821716i6e1h5f9860h8e00004d9884ga7e57234h7565264462549653373'\r\n    version='2.6'>\r\n    <pod title='Input interpretation'\r\n     scanner='Identity'\r\n     id='Input'\r\n     position='100'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1821816i6e1h5f9860h8e00000g410g7e2078abh5?MSPStoreType=image/gif&amp;s=41'\r\n       alt='convert 905 psi (pounds-force per square inch) to bars'\r\n       title='convert 905 psi (pounds-force per square inch) to bars'\r\n       width='348'\r\n       height='18' />\r\n            <plaintext>convert 905 psi (pounds-force per square inch) to bars</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Result'\r\n     scanner='Identity'\r\n     id='Result'\r\n     position='200'\r\n     error='false'\r\n     numsubpods='1'\r\n     primary='true'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1821916i6e1h5f9860h8e000054i8cgi343f6h1c1?MSPStoreType=image/gif&amp;s=41'\r\n       alt='62.4 bars'\r\n       title='62.4 bars'\r\n       width='59'\r\n       height='18' />\r\n            <plaintext>62.4 bars</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Additional conversions'\r\n     scanner='Unit'\r\n     id='AdditionalConversion'\r\n     position='300'\r\n     error='false'\r\n     numsubpods='5'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822016i6e1h5f9860h8e00002d3fgf4ii7f8ddga?MSPStoreType=image/gif&amp;s=41'\r\n       alt='624 dbar (decibars)'\r\n       title='624 dbar (decibars)'\r\n       width='124'\r\n       height='18' />\r\n            <plaintext>624 dbar (decibars)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822116i6e1h5f9860h8e000049d9e3i1c7g39916?MSPStoreType=image/gif&amp;s=41'\r\n       alt='0.0624 kbar (kilobars)'\r\n       title='0.0624 kbar (kilobars)'\r\n       width='138'\r\n       height='18' />\r\n            <plaintext>0.0624 kbar (kilobars)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822216i6e1h5f9860h8e00004hb1ba0gg7b69f77?MSPStoreType=image/gif&amp;s=41'\r\n       alt='6.24 MPa (megapascals)'\r\n       title='6.24 MPa (megapascals)'\r\n       width='157'\r\n       height='18' />\r\n            <plaintext>6.24 MPa (megapascals)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822316i6e1h5f9860h8e00002id5a23f844ha0f4?MSPStoreType=image/gif&amp;s=41'\r\n       alt='6.24\u00D710^6 Pa (pascals)'\r\n       title='6.24\u00D710^6 Pa (pascals)'\r\n       width='144'\r\n       height='18' />\r\n            <plaintext>6.24\u00D710^6 Pa (pascals)</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822416i6e1h5f9860h8e00003cbe5b9e014bf5de?MSPStoreType=image/gif&amp;s=41'\r\n       alt='6.24\u00D710^6 N/m^2 (newtons per square meter)'\r\n       title='6.24\u00D710^6 N/m^2 (newtons per square meter)'\r\n       width='284'\r\n       height='18' />\r\n            <plaintext>6.24\u00D710^6 N/m^2 (newtons per square meter)</plaintext>\r\n        </subpod>\r\n        <states count='1'>\r\n            <state name='More'\r\n       input='AdditionalConversion__More' />\r\n        </states>\r\n    </pod>\r\n    <pod title='Comparisons'\r\n     scanner='Unit'\r\n     id='Comparison'\r\n     position='400'\r\n     error='false'\r\n     numsubpods='3'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822516i6e1h5f9860h8e000031fd89544da14h85?MSPStoreType=image/gif&amp;s=41'\r\n       alt=' \u2248 (0.2 to 0.9) \u00D7 nozzle pressure of a pressure washer ( 6.9\u00D710^6 to 2.7\u00D710^7 Pa )'\r\n       title=' \u2248 (0.2 to 0.9) \u00D7 nozzle pressure of a pressure washer ( 6.9\u00D710^6 to 2.7\u00D710^7 Pa )'\r\n       width='483'\r\n       height='18' />\r\n            <plaintext> \u2248 (0.2 to 0.9) \u00D7 nozzle pressure of a pressure washer ( 6.9\u00D710^6 to 2.7\u00D710^7 Pa )</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822616i6e1h5f9860h8e00002hcg62iefbh82a0e?MSPStoreType=image/gif&amp;s=41'\r\n       alt=' \u2248 0.62 \u00D7 pressure exerted by a 45 kg woman wearing stiletto heels (\u2248 1\u00D710^7 Pa )'\r\n       title=' \u2248 0.62 \u00D7 pressure exerted by a 45 kg woman wearing stiletto heels (\u2248 1\u00D710^7 Pa )'\r\n       width='501'\r\n       height='18' />\r\n            <plaintext> \u2248 0.62 \u00D7 pressure exerted by a 45 kg woman wearing stiletto heels (\u2248 1\u00D710^7 Pa )</plaintext>\r\n        </subpod>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822716i6e1h5f9860h8e00003118h9d0fe6d340d?MSPStoreType=image/gif&amp;s=41'\r\n       alt=' \u2248 0.7 \u00D7 atmospheric pressure on the surface of Venus (\u2248 9 MPa )'\r\n       title=' \u2248 0.7 \u00D7 atmospheric pressure on the surface of Venus (\u2248 9 MPa )'\r\n       width='399'\r\n       height='18' />\r\n            <plaintext> \u2248 0.7 \u00D7 atmospheric pressure on the surface of Venus (\u2248 9 MPa )</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Interpretation'\r\n     scanner='Unit'\r\n     id='Interpretation'\r\n     position='500'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822816i6e1h5f9860h8e0000486hi80d2gg53485?MSPStoreType=image/gif&amp;s=41'\r\n       alt='pressure'\r\n       title='pressure'\r\n       width='56'\r\n       height='18' />\r\n            <plaintext>pressure</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Basic unit dimensions'\r\n     scanner='Unit'\r\n     id='BasicUnitDimensions'\r\n     position='600'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1822916i6e1h5f9860h8e000018b7ba3a4b786i6f?MSPStoreType=image/gif&amp;s=41'\r\n       alt='[mass] [length]^(-1) [time]^(-2)'\r\n       title='[mass] [length]^(-1) [time]^(-2)'\r\n       width='160'\r\n       height='18' />\r\n            <plaintext>[mass] [length]^(-1) [time]^(-2)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <pod title='Corresponding quantity'\r\n     scanner='Unit'\r\n     id='CorrespondingQuantity'\r\n     position='700'\r\n     error='false'\r\n     numsubpods='1'>\r\n        <subpod title=''>\r\n            <img src='http://www4b.wolframalpha.com/Calculate/MSP/MSP1823016i6e1h5f9860h8e000014a391i4e87154h6?MSPStoreType=image/gif&amp;s=41'\r\n       alt='Depth of water d giving overpressure P from P = \u03C1_(H_2O)gh:\r\n | 636 meters\r\n | 0.4 miles\r\n | 2088 feet\r\n | (assuming maximum water density \u2248 1000 kg/m^3)'\r\n       title='Depth of water d giving overpressure P from P = \u03C1_(H_2O)gh:\r\n | 636 meters\r\n | 0.4 miles\r\n | 2088 feet\r\n | (assuming maximum water density \u2248 1000 kg/m^3)'\r\n       width='375'\r\n       height='105' />\r\n            <plaintext>Depth of water d giving overpressure P from P = \u03C1_(H_2O)gh:\r\n | 636 meters\r\n | 0.4 miles\r\n | 2088 feet\r\n | (assuming maximum water density \u2248 1000 kg/m^3)</plaintext>\r\n        </subpod>\r\n    </pod>\r\n    <assumptions count='1'>\r\n        <assumption type='Unit'\r\n      word='bar'\r\n      template='Assuming ${desc1} for &quot;${word}&quot;. Use ${desc2} instead'\r\n      count='2'>\r\n            <value name='Bars'\r\n       desc='standard bars'\r\n       input='UnitClash_*bar.*Bars--' />\r\n            <value name='BarCGS'\r\n       desc='cgs bars'\r\n       input='UnitClash_*bar.*BarCGS--' />\r\n        </assumption>\r\n    </assumptions>\r\n</queryresult>";
		Assert.assertEquals("62.4 bars", unitConversionService.extractResult(input, "905psi", "bar"));
	}

	@Test
	public void testCleanResult() throws JAXBException {
		String input = "73.4 °F (degrees Fahrenheit)";
		final String cleanResult = unitConversionService.cleanResult(input);
		Assert.assertEquals("73.4 °F", cleanResult);
	}

	@Test
	public void test() {
		final String source = "23.3°C";
		final String unit = "°F";
		Assert.assertEquals("73.94 °F", unitConversionService.convert(source, unit));
	}
}
